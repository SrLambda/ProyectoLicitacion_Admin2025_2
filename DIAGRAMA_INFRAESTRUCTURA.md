# ๐๏ธ Diagrama de Infraestructura - Sistema de Gestiรณn de Causas Judiciales

**Proyecto:** Sistema de Gestiรณn de Causas Judiciales  
**Fecha:** 11 de Noviembre de 2025  
**Versiรณn:** 1.0

---

## ๐ Arquitectura General del Sistema

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                   INTERNET                                       โ
โ                                      โ                                           โ
โ                           Puerto 80 (HTTP) / 443 (HTTPS)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          ๐ FRONTEND-NETWORK (172.20.0.0/24)                      โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                        TRAEFIK GATEWAY (Load Balancer)                   โ   โ
โ  โ  - Routing automรกtico                                                     โ   โ
โ  โ  - Health checks                                                          โ   โ
โ  โ  - Dashboard: :8080                                                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                      โ                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                 โ
โ  โ   FRONTEND-1 (React)     โ     โ   FRONTEND-2 (React)     โ                 โ
โ  โ   Puerto: 3000           โ     โ   Puerto: 3000           โ                 โ
โ  โ   Status: โ Running     โ     โ   Status: โ Running     โ                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         ๐ง BACKEND-NETWORK (172.21.0.0/24)                        โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โ  โ AUTENTICACION   โ  โ    CASOS-1      โ  โ    CASOS-2      โ                 โ
โ  โ Puerto: 8000    โ  โ Puerto: 5001    โ  โ Puerto: 5001    โ                 โ
โ  โ JWT, Login      โ  โ CRUD Causas     โ  โ CRUD Causas     โ                 โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โ  โ  DOCUMENTOS     โ  โ NOTIFICACIONES  โ  โ   REPORTES      โ                 โ
โ  โ  Puerto: 8002   โ  โ  Puerto: 8003   โ  โ  Puerto: 8004   โ                 โ
โ  โ  Upload/Files   โ  โ  Alertas        โ  โ  PDFs/Excel     โ                 โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                โ
โ  โ                    IA-SEGURIDAD                              โ                โ
โ  โ  Puerto: 8005                                                โ                โ
โ  โ  โข Anรกlisis de logs con Gemini AI                           โ                โ
โ  โ  โข Detecciรณn de anomalรญas                                   โ                โ
โ  โ  โข Sistema de alertas inteligente                           โ                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โ  โ  DB-PROXY       โ  โ     CRON        โ  โ    MAILHOG      โ                 โ
โ  โ  (ProxySQL)     โ  โ  Tareas Auto    โ  โ  Test Email     โ                 โ
โ  โ  Puerto: 6033   โ  โ  Backup: 01:00  โ  โ  Puerto: 8025   โ                 โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ                           โ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       ๐พ DATABASE-NETWORK (172.22.0.0/24)                         โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ                         MYSQL REPLICATION                               โ     โ
โ  โ                                                                          โ     โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ         GTID         โโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ  โ   DB-MASTER          โ โโโโโโโโโโโโโโโโโโโ> โ    DB-SLAVE          โโ     โ
โ  โ  โ   MySQL 8.4.7        โ   Auto-Position     โ    MySQL 8.4.7       โโ     โ
โ  โ  โ   server_id: 1       โ   Replication       โ    server_id: 2      โโ     โ
โ  โ  โ   Puerto: 3306       โ   IO: โ Yes         โ    Puerto: 3306      โโ     โ
โ  โ  โ   Puerto ext: 3307   โ   SQL: โ Yes        โ    Puerto ext: 3308  โโ     โ
โ  โ  โ   Status: โ Healthy โ                     โ    Status: โ Healthy โโ     โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ                     โโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ  โ                 โ                                        โ             โ     โ
โ  โ                 โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ             โ     โ
โ  โ                                  โ                                     โ     โ
โ  โ                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                        โ     โ
โ  โ                    โ  PROXYSQL (Load Balancer)โ                        โ     โ
โ  โ                    โ  Puerto: 6033            โ                        โ     โ
โ  โ                    โ  Admin: 6032             โ                        โ     โ
โ  โ                    โ                          โ                        โ     โ
โ  โ                    โ  Hostgroup 10 โ Master   โ                        โ     โ
โ  โ                    โ  Hostgroup 20 โ Slave    โ                        โ     โ
โ  โ                    โ                          โ                        โ     โ
โ  โ                    โ  Rules:                  โ                        โ     โ
โ  โ                    โ  SELECT FOR UPDATE โ 10  โ                        โ     โ
โ  โ                    โ  SELECT โ 20             โ                        โ     โ
โ  โ                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                        โ     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                                       โ
โ  โ BACKUP-SERVICE  โ  โ FAILOVER-DAEMON โ                                       โ
โ  โ Backups Auto    โ  โ Check: 30s      โ                                       โ
โ  โ Retention: 7d   โ  โ Threshold: 3    โ                                       โ
โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐๏ธ  CACHE-NETWORK (172.23.0.0/24)                         โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ      โ
โ  โ                         REDIS REPLICATION                              โ      โ
โ  โ                                                                         โ      โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ                   โโโโโโโโโโโโโโโโโโโโโโโโ  โ      โ
โ  โ  โ   REDIS MASTER       โ โโโโโโโโโโโโโโโโโ>โ   REDIS REPLICA      โ  โ      โ
โ  โ  โ   Redis 7.4.7        โ   Master-Slave    โ   Redis 7.4.7        โ  โ      โ
โ  โ  โ   role: master       โ   Replication     โ   role: slave        โ  โ      โ
โ  โ  โ   Puerto: 6379       โ                   โ   Puerto: 6380       โ  โ      โ
โ  โ  โ   Slaves: 1          โ   Link: โ UP      โ   Master: redis      โ  โ      โ
โ  โ  โ   Auth: โ redis_2025โ                   โ   Auth: โ redis_2025โ  โ      โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ                   โโโโโโโโโโโโโโโโโโโโโโโโ  โ      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ      โ
โ                                                                                   โ
โ  Servicios conectados: autenticacion, casos-1, casos-2, notificaciones          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ๐ MONITORING-NETWORK (172.24.0.0/24)                        โ
โ                                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ                      STACK DE MONITOREO                                  โ    โ
โ  โ                                                                           โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ                   โโโโโโโโโโโโโโโโโโโโโโโโ    โ    โ
โ  โ  โ   PROMETHEUS         โ โโโโโโโscrapeโโโโ>โ     GRAFANA          โ    โ    โ
โ  โ  โ   Puerto: 9090       โ                   โ     v12.2.1          โ    โ    โ
โ  โ  โ   Interval: 15s      โ                   โ     Puerto: 3000     โ    โ    โ
โ  โ  โ                      โ                   โ     DB: โ OK        โ    โ    โ
โ  โ  โ   Targets:           โ                   โ                      โ    โ    โ
โ  โ  โ   โข MySQL Exporter   โ                   โ   Dashboards:        โ    โ    โ
โ  โ  โ   โข Redis Exporter   โ                   โ   โข Sistema          โ    โ    โ
โ  โ  โ   โข Node Exporter    โ                   โ   โข MySQL            โ    โ    โ
โ  โ  โ   โข Backend Services โ                   โ   โข Redis            โ    โ    โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโ                   โโโโโโโโโโโโโโโโโโโโโโโโ    โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ                                                                                   โ
โ  Servicios conectados: ia-seguridad, backup-service, failover-daemon            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Alta Disponibilidad

### Escenario 1: Operaciรณn Normal

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         ESTADO NORMAL                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                          โ
โ  USUARIO โ TRAEFIK โ FRONTEND-1 โ                                      โ
โ                   โโ FRONTEND-2 โ  (Load Balancing Round Robin)       โ
โ                                                                          โ
โ  FRONTEND โ TRAEFIK โ CASOS-1 โ                                        โ
โ                   โโ CASOS-2 โ  (Load Balancing)                       โ
โ                                                                          โ
โ  BACKEND โ PROXYSQL โ SELECT queries โ DB-SLAVE โ                      โ
โ                   โโ INSERT/UPDATE โ DB-MASTER โ                       โ
โ                                                                          โ
โ  BACKEND โ REDIS-MASTER โ โโโโโreplicaโโโโ> REDIS-REPLICA โ           โ
โ                                                                          โ
โ  FAILOVER-DAEMON: Master health: โ OK  (check cada 30s)                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Escenario 2: Fallo de Rรฉplica Frontend

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FALLO: FRONTEND-2 CAรDO                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                          โ
โ  USUARIO โ TRAEFIK โ FRONTEND-1 โ  (Todo el trรกfico)                  โ
โ                   โโ FRONTEND-2 โ  (Traefik detecta y excluye)        โ
โ                                                                          โ
โ  Health Check: FRONTEND-1 responde โ Sistema operacional โ             โ
โ                                                                          โ
โ  ACCIรN: Traefik redirige automรกticamente todo a FRONTEND-1             โ
โ  RESULTADO: โ Servicio continรบa sin interrupciรณn                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Escenario 3: Fallo de MySQL Master

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FALLO: DB-MASTER CAรDO                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                          โ
โ  1. FAILOVER-DAEMON detecta fallo (3 checks consecutivos fallidos)     โ
โ     โ                                                                    โ
โ  2. Promueve DB-SLAVE a MASTER                                          โ
โ     โ                                                                    โ
โ  3. Reconfigura ProxySQL:                                               โ
โ     - Hostgroup 10 (WRITE) โ DB-SLAVE (ahora master)                   โ
โ     - Hostgroup 20 (READ) โ DB-SLAVE                                   โ
โ     โ                                                                    โ
โ  4. Notifica a servicios                                                โ
โ     โ                                                                    โ
โ  5. Sistema continรบa operando desde nuevo master โ                     โ
โ                                                                          โ
โ  TIEMPO DE FAILOVER: ~90 segundos (3 checks ร 30s)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Escenario 4: Recuperaciรณn Master (Failback)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                DB-MASTER SE RECUPERA (FAILBACK)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                          โ
โ  1. FAILOVER-DAEMON detecta que DB-MASTER estรก disponible              โ
โ     โ                                                                    โ
โ  2. Verifica integridad de datos                                        โ
โ     โ                                                                    โ
โ  3. Configura DB-MASTER como SLAVE del actual master                   โ
โ     โ                                                                    โ
โ  4. Sincroniza datos via GTID                                           โ
โ     โ                                                                    โ
โ  5. Cuando estรก sincronizado, restablece roles:                         โ
โ     - DB-MASTER vuelve a ser MASTER                                     โ
โ     - DB-SLAVE vuelve a ser SLAVE                                       โ
โ     โ                                                                    โ
โ  6. Reconfigura ProxySQL a estado original                              โ
โ     โ                                                                    โ
โ  7. Sistema vuelve a arquitectura normal โ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Segmentaciรณn de Redes - Vista Detallada

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FRONTEND-NETWORK (172.20.0.0/24)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข gateway              โ รnico punto de entrada/salida                  โ
โ  โข frontend-1           โ Sirve aplicaciรณn React                         โ
โ  โข frontend-2           โ Rรฉplica para HA                                โ
โ                                                                           โ
โ  PROPรSITO: Capa de presentaciรณn aislada                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BACKEND-NETWORK (172.21.0.0/24)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข gateway              โ Router entre frontend y backend                โ
โ  โข autenticacion        โ API de auth                                    โ
โ  โข casos-1, casos-2     โ Microservicio principal (2 rรฉplicas)          โ
โ  โข documentos           โ Gestiรณn de archivos                            โ
โ  โข notificaciones       โ Sistema de alertas                             โ
โ  โข reportes             โ Generaciรณn de reportes                         โ
โ  โข ia-seguridad         โ Anรกlisis inteligente                           โ
โ  โข mailhog              โ Testing de emails                              โ
โ  โข cron                 โ Tareas programadas                             โ
โ  โข db-proxy             โ Acceso a bases de datos                        โ
โ                                                                           โ
โ  PROPรSITO: Lรณgica de negocio aislada                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   DATABASE-NETWORK (172.22.0.0/24)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข db-master            โ MySQL principal                                โ
โ  โข db-slave             โ Rรฉplica de lectura                             โ
โ  โข db-proxy             โ ProxySQL load balancer                         โ
โ  โข autenticacion        โ Servicios con acceso a DB                      โ
โ  โข casos-1, casos-2     โ Servicios con acceso a DB                      โ
โ  โข documentos           โ Servicios con acceso a DB                      โ
โ  โข notificaciones       โ Servicios con acceso a DB                      โ
โ  โข reportes             โ Servicios con acceso a DB                      โ
โ  โข backup-service       โ Backups de DB                                  โ
โ  โข failover-daemon      โ Monitoreo y failover                           โ
โ                                                                           โ
โ  PROPรSITO: Capa de persistencia protegida                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CACHE-NETWORK (172.23.0.0/24)                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข redis                โ Cache principal                                โ
โ  โข redis-replica        โ Rรฉplica de cache                               โ
โ  โข autenticacion        โ Sesiones de usuario                            โ
โ  โข casos-1, casos-2     โ Cache de consultas                             โ
โ  โข notificaciones       โ Queue de notificaciones                        โ
โ                                                                           โ
โ  PROPรSITO: Cache distribuido para performance                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  MONITORING-NETWORK (172.24.0.0/24)                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข prometheus           โ Recolecciรณn de mรฉtricas                        โ
โ  โข grafana              โ Visualizaciรณn                                  โ
โ  โข ia-seguridad         โ Analiza mรฉtricas con IA                        โ
โ  โข backup-service       โ Mรฉtricas de backups                            โ
โ  โข failover-daemon      โ Mรฉtricas de HA                                 โ
โ                                                                           โ
โ  PROPรSITO: Observabilidad del sistema                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐พ Persistencia de Datos - Volรบmenes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          VOLรMENES DOCKER                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  BASES DE DATOS:                                                           โ
โ  โโ mysql-master-data         โ /var/lib/mysql (db-master)                โ
โ  โโ mysql-slave-data          โ /var/lib/mysql (db-slave)                 โ
โ  โโ redis-data                โ /data (redis)                              โ
โ  โโ proxysql-data             โ /var/lib/proxysql                          โ
โ                                                                             โ
โ  CONFIGURACIONES:                                                          โ
โ  โโ traefik-config            โ /etc/traefik                               โ
โ  โโ prometheus-config         โ /etc/prometheus                            โ
โ  โโ proxysql-config           โ /etc/proxysql                              โ
โ  โโ redis-config              โ /etc/redis                                 โ
โ  โโ db-master-init-scripts    โ /docker-entrypoint-initdb.d               โ
โ  โโ db-slave-init-scripts     โ /docker-entrypoint-initdb.d               โ
โ                                                                             โ
โ  DATOS DE APLICACIรN:                                                      โ
โ  โโ documentos-uploads        โ /app/uploads (documentos)                 โ
โ  โโ grafana-data              โ /var/lib/grafana                           โ
โ  โโ prometheus-data           โ /prometheus                                โ
โ  โโ frontend-node-modules     โ /app/node_modules                          โ
โ                                                                             โ
โ  BACKUPS (Host mount):                                                     โ
โ  โโ ./backups                 โ /backups (backup-service)                 โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Datos - Operaciones CRUD

### Crear Caso (POST /api/casos)

```
Usuario                                                          
   โ                                                             
   โ 1. POST /api/casos                                         
   โ                                                             
โโโโโโโโโโ                                                       
โ TRAEFIKโโโโ                                                   
โโโโโโโโโโ  โ                                                   
            โ 2. Route to backend                               
            โ                                                   
      โโโโโโโโโโโ                                               
      โ CASOS-1 โ  โ Load balancing                            
      โโโโโโโโโโโ                                               
      โโโโโโโโโโโ                                               
      โ CASOS-2 โ  โ Alternate                                 
      โโโโโโโโโโโ                                               
            โ                                                   
            โ 3. Verify JWT                                     
            โ                                                   
    โโโโโโโโโโโโโโโโ                                            
    โ AUTENTICACIONโ                                            
    โโโโโโโโโโโโโโโโ                                            
            โ                                                   
            โ 4. Token vรกlido โ                                
            โ                                                   
      โโโโโโโโโโโ                                               
      โ PROXYSQLโ                                               
      โโโโโโโโโโโ                                               
            โ                                                   
            โ 5. INSERT โ Hostgroup 10 (WRITE)                 
            โ                                                   
      โโโโโโโโโโโโ         GTID          โโโโโโโโโโโโ         
      โDB-MASTER โ โโโโโโโโโโโโโโโโโโโโโ>โ DB-SLAVE โ         
      โโโโโโโโโโโโ    Auto-Replicate     โโโโโโโโโโโโ         
            โ                                                   
            โ 6. Registro creado                                
            โ                                                   
      โโโโโโโโโโโ                                               
      โ REDIS   โ โ Cache invalidado                           
      โโโโโโโโโโโ                                               
            โ                                                   
            โ 7. Response JSON                                  
            โ                                                   
        Usuario โ                                              
```

### Consultar Casos (GET /api/casos)

```
Usuario                                                          
   โ                                                             
   โ 1. GET /api/casos                                          
   โ                                                             
โโโโโโโโโโ                                                       
โ TRAEFIKโ                                                       
โโโโโโโโโโ                                                       
   โ                                                             
   โ 2. Route to backend                                        
   โ                                                             
โโโโโโโโโโโ                                                      
โ CASOS-1 โ                                                      
โโโโโโโโโโโ                                                      
   โ                                                             
   โ 3. Check cache                                             
   โ                                                             
โโโโโโโโโโโ                                                      
โ REDIS   โ โ Cache hit? โ Return                              
โโโโโโโโโโโ                                                      
   โ                                                             
   โ Cache miss โ Query DB                                      
   โ                                                             
โโโโโโโโโโโ                                                      
โ PROXYSQLโ                                                      
โโโโโโโโโโโ                                                      
   โ                                                             
   โ 4. SELECT โ Hostgroup 20 (READ)                           
   โ                                                             
โโโโโโโโโโโโ                                                     
โ DB-SLAVE โ โ Consulta rรฉplica (reduce carga master)          
โโโโโโโโโโโโ                                                     
   โ                                                             
   โ 5. Resultados                                              
   โ                                                             
โโโโโโโโโโโ                                                      
โ REDIS   โ โ Store in cache                                   
โโโโโโโโโโโ                                                      
   โ                                                             
   โ 6. Response JSON                                           
   โ                                                             
Usuario โ                                                       
```

---

## ๐ค Flujo de IA - Anรกlisis de Logs

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   SISTEMA DE ANรLISIS CON IA                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. RECOLECCIรN DE LOGS
   โ
โโโโโโโโโโโโโโโโ
โ Contenedores โ โโโ Docker API โโโ โโโโโโโโโโโโโโโโโโ
โ - db-master  โ                     โ                โ
โ - casos-1    โ                     โ  IA-SEGURIDAD  โ
โ - frontend   โ                     โ                โ
โ - etc...     โ                     โโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโ                              โ
                                              โ
2. ANรLISIS INTELIGENTE                       โ
   โ                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              GEMINI 2.0-FLASH-LITE                   โ
โ                                                      โ
โ  โข Detecta errores y warnings                       โ
โ  โข Identifica problemas de seguridad                โ
โ  โข Analiza patrones anรณmalos                        โ
โ  โข Genera diagnรณsticos                              โ
โ  โข Sugiere soluciones                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
3. DETECCIรN DE ANOMALรAS  โ
   โ                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Health Monitor                                       โ
โ  โข Container down (crรญtico)                          โ
โ  โข Alto uso CPU (> 80%)                              โ
โ  โข Alto uso memoria (> 85%)                          โ
โ  โข Errores recurrentes                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
4. SISTEMA DE ALERTAS      โ
   โ                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Almacenamiento en BD                                โ
โ  Severidad: info | warning | error | critical        โ
โ  Timestamp, container, tipo, mensaje                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
5. NOTIFICACIรN            โ
   โ                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โข Dashboard web (consulta via API)                  โ
โ  โข Prometheus metrics                                โ
โ  โข Grafana alerts                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Monitoreo - Flujo de Mรฉtricas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      STACK DE OBSERVABILIDAD                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

EXPORTERS                  PROMETHEUS              GRAFANA
    โ                          โ                      โ
    โ                          โ                      โ
โโโโโโโโโโโโ                  โ                      โ
โ MySQL    โโโmetricsโโโโโโโ  โ                      โ
โ Exporter โ               โ  โ                      โ
โโโโโโโโโโโโ               โ  โ                      โ
                           โ  โ                      โ
โโโโโโโโโโโโ          โโโโโโโโโโโโโโโโ              โ
โ  Redis   โโmetricsโ>โ  PROMETHEUS  โโโqueryโโโโโ  โ
โ Exporter โ          โ              โ           โ  โ
โโโโโโโโโโโโ          โ  Scrape: 15s โ           โ  โ
                      โ  Retention:  โ     โโโโโโโโโโโโโโ
โโโโโโโโโโโโ          โ    15 days   โ     โ  GRAFANA   โ
โ   Node   โโmetricsโ>โ              โโโโโ>โ            โ
โ Exporter โ          โโโโโโโโโโโโโโโโ     โ Dashboards:โ
โโโโโโโโโโโโ                 โ             โ โข Sistema  โ
                             โ             โ โข MySQL    โ
Backend Services             โ             โ โข Redis    โ
โโโโโโโโโโโโ                 โ             โ โข Docker   โ
โ  casos   โโโ/metricsโโโโโโโโค             โโโโโโโโโโโโโโ
โ  auth    โ                 โ                    โ
โ  docs    โ                 โ                    โ
โโโโโโโโโโโโ                 โ                    โ
                             โ              Admin visualiza
IA-Seguridad                 โ              mรฉtricas en
โโโโโโโโโโโโ                 โ              tiempo real
โ   IA     โโโstatsโโโโโโโโโโโ              
โ Security โ  
โโโโโโโโโโโโ
```

---

## ๐ Sistema de Backups - Flujo Completo

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      SISTEMA DE BACKUPS                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CRON SERVICE (01:00 AM diario)
    โ
    โ Trigger
    โ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  BACKUP-SERVICE     โ
โโโโโโโโโโโโโโโโโโโโโโโ
    โ
    โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
    โ                 โ                 โ
    โ                 โ                 โ
โโโโโโโโโโโ   โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
โ DB      โ   โ  ARCHIVOS    โ  โ CONFIGURACIรNโ
โ BACKUP  โ   โ  BACKUP      โ  โ  BACKUP      โ
โโโโโโโโโโโ   โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
    โ                 โ                 โ
    โ                 โ                 โ
    โโโ mysqldump    โโโ tar           โโโ copy configs
    โ   db-master    โ   /uploads      โ   /etc/*
    โ   via proxy    โ   /data         โ
    โ                 โ                 โ
    โ                 โ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  /backups/database/                           โ
โ    db_gestion_causas_2025-11-11_01-00-00.sql โ
โ                                               โ
โ  /backups/files/                              โ
โ    files_2025-11-11_01-00-00.tar.gz          โ
โ                                               โ
โ  /backups/config/                             โ
โ    config_2025-11-11_01-00-00.tar.gz         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ
    โ Consolidate
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  /backups/complete/                           โ
โ    backup_complete_2025-11-11_01-00-00.tar.gzโ
โ                                               โ
โ  Contiene:                                    โ
โ  โข Base de datos completa                    โ
โ  โข Todos los archivos subidos                โ
โ  โข Configuraciones del sistema               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ
    โ Cleanup
    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  LIMPIEZA AUTOMรTICA                          โ
โ  โข Elimina backups > 7 dรญas                   โ
โ  โข Mantiene al menos 7 backups diarios        โ
โ  โข Libera espacio en disco                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Puertos y Endpoints

### Puertos Externos (acceso desde host)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Puerto  โ  Servicio          โ  Descripciรณn             โ
โโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  80      โ  Traefik           โ  HTTP (Frontend + APIs) โ
โ  3000    โ  Grafana           โ  Dashboard monitoreo    โ
โ  3307    โ  MySQL Master      โ  Base de datos (admin)  โ
โ  3308    โ  MySQL Slave       โ  Rรฉplica (readonly)     โ
โ  6033    โ  ProxySQL          โ  Load balancer DB       โ
โ  6379    โ  Redis Master      โ  Cache principal        โ
โ  6380    โ  Redis Replica     โ  Cache rรฉplica          โ
โ  8025    โ  MailHog           โ  Web UI testing email   โ
โ  8080    โ  Traefik Dashboard โ  Monitoring gateway     โ
โ  9090    โ  Prometheus        โ  Mรฉtricas               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Puertos Internos (solo entre contenedores)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Puerto  โ  Servicio          โ  Red                     โ
โโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  3000    โ  Frontend          โ  frontend-network       โ
โ  5001    โ  Casos             โ  backend-network        โ
โ  8000    โ  Autenticacion     โ  backend-network        โ
โ  8002    โ  Documentos        โ  backend-network        โ
โ  8003    โ  Notificaciones    โ  backend-network        โ
โ  8004    โ  Reportes          โ  backend-network        โ
โ  8005    โ  IA-Seguridad      โ  backend-network        โ
โ  3306    โ  MySQL (interno)   โ  database-network       โ
โ  6032    โ  ProxySQL Admin    โ  database-network       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ Tabla de Decisiones de Arquitectura

### ยฟPor quรฉ esta arquitectura?

| Decisiรณn | Alternativa | Razรณn de Elecciรณn |
|----------|-------------|-------------------|
| **Traefik** | Nginx, HAProxy | Routing automรกtico, discovery de servicios, dashboard integrado |
| **ProxySQL** | HAProxy, MaxScale | Especializado en MySQL, query routing inteligente, cache de queries |
| **MySQL GTID** | Binlog position | Failover mรกs simple, consistencia garantizada, auto-positioning |
| **Redis Replica** | Redis Sentinel | Mรกs simple para el scope, suficiente para HA bรกsica |
| **Prometheus+Grafana** | ELK, Portainer | Stack estรกndar industria, dashboards potentes, alertas configurables |
| **Gemini AI** | Ollama local | API externa mรกs rรกpida, mejor calidad, menor carga infraestructura |
| **5 redes** | 1 red | Segmentaciรณn por capas, mayor seguridad, aislamiento de fallas |
| **Docker Compose** | Kubernetes | Mรกs simple para demo, adecuado para el alcance, rรกpido deployment |
| **Flask** | FastAPI, Express | Conocido, simple, rรกpido desarrollo, buena documentaciรณn |
| **React** | Vue, Angular | Ecosistema grande, performance, ampliamente adoptado |

---

## ๐ Evoluciรณn del Sistema

### Fase Actual: MVP Completado โ

```
[Frontend HA] โโโโโโโโโ โ Implementado
[Backend Services] โโโโ โ 6 microservicios
[MySQL HA] โโโโโโโโโโโ โ Master-Slave + ProxySQL
[Redis HA] โโโโโโโโโโโ โ Master-Replica
[Backups] โโโโโโโโโโโโ โ Automatizados 
[Monitoreo] โโโโโโโโโโ โ Prometheus+Grafana
[IA] โโโโโโโโโโโโโโโโโ โ Gemini anรกlisis logs
[Failover] โโโโโโโโโโโ โ Auto-failover daemon
```

### Mejoras Futuras (Roadmap)

```
Fase 2: Producciรณn Enterprise
โโ Kubernetes deployment
โโ Redis Sentinel (3 sentinels)
โโ MySQL Orchestrator
โโ Vault para secretos
โโ CI/CD Pipeline (GitLab/GitHub Actions)
โโ SSL/TLS en todas las comunicaciones

Fase 3: Escalabilidad
โโ Auto-scaling horizontal
โโ CDN para assets estรกticos
โโ Mรบltiples zonas de disponibilidad
โโ Database sharding
โโ Message queue (RabbitMQ/Kafka)

Fase 4: Avanzado
โโ Service mesh (Istio)
โโ Distributed tracing (Jaeger)
โโ Chaos engineering
โโ Multi-regiรณn replication
โโ ML-powered auto-optimization
```

---

## โ Estado Actual: 100% Operacional

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  HEALTH CHECK SUMMARY                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                           โ
โ  ๐ข Frontend (2/2 rรฉplicas)        โ Healthy           โ
โ  ๐ข Backend Services (6/6)         โ Healthy           โ
โ  ๐ข MySQL Master                   โ Healthy           โ
โ  ๐ข MySQL Slave                    โ Replicating       โ
โ  ๐ข ProxySQL                       โ Load Balancing    โ
โ  ๐ข Redis Master                   โ Healthy           โ
โ  ๐ข Redis Replica                  โ Replicating       โ
โ  ๐ข Prometheus                     โ Scraping          โ
โ  ๐ข Grafana                        โ Healthy           โ
โ  ๐ข IA-Seguridad                   โ Analyzing         โ
โ  ๐ข Failover Daemon                โ Monitoring        โ
โ  ๐ข Backup Service                 โ Scheduled         โ
โ                                                           โ
โ  TOTAL: 21 containers activos                            โ
โ  ESTADO: โ 100% OPERACIONAL                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**Generado:** 11 de Noviembre de 2025  
**Proyecto:** Sistema de Gestiรณn de Causas Judiciales  
**Versiรณn Infraestructura:** 1.0  
**Estado:** โ Producciรณn Ready
